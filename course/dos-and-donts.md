# DOs and DON'Ts

Чек-лист правил работы с ИИ-инструментами. Собрано из всех модулей курса.

---

## 1. Промптинг

**DO:**
- Структурируй: роль -> контекст -> задача -> критерии приемки
- Указывай ограничения: стек, версии, конвенции проекта
- Используй few-shot примеры для специфичных паттернов
- Разбивай сложное на цепочку: анализ -> план -> реализация -> тесты
- Одна задача = один промпт = один чёткий результат

**DON'T:**
- Нечёткие формулировки ("сделай красивее", "оптимизируй")
- God-prompt -- всё в одном запросе
- Промпт без контекста и без критериев приемки
- Смешанная ответственность ("добавь endpoint и заодно отрефактори модуль")

---

## 2. Инструменты

**DO:**
- Комбинируй: Opus для архитектуры, Sonnet для реализации, DeepSeek/Haiku для рутины
- Batch API для не-срочных задач, Prompt Caching для длинных сессий
- Держи резервного провайдера

**DON'T:**
- Opus/GPT-5 для boilerplate
- Один провайдер на всё
- Игнорировать рост расходов

---

## 3. Работа с агентами

**DO:**
- Разделяй Plan и Act -- проверяй план до начала реализации
- TDD: сначала тесты, потом реализация, агент итерирует до зелёных
- Ralph Loop: Do -> Check (тесты/линтер) -> Fix -> повторять
- Настрой AGENTS.md: стек, паттерны, antipatterns, конвенции
- Обновляй AGENTS.md и memories после каждого нового типа ошибки

**DON'T:**
- Доверять архитектурные решения без твоего согласия
- Задача на 200+ строк за раз -- декомпозируй
- Пропускать code review "потому что тесты прошли"
- Писать в AGENTS.md то, что проверяется линтером

---

## 4. Режимы: HITL vs YOLO

**DO:**

| Agentic (безопасно) | HITL (обязательно) |
|---------------------|--------------------|
| Unit-тесты | `git push` в main |
| Рефакторинг метода | Удаление файлов |
| CRUD endpoint | Изменение production БД |
| Генерация документации | Деплой в production |

Правило: деструктивное, необратимое, видимое другим -> HITL.

**DON'T:**
- YOLO в production -- только в тестовых проектах и Docker-контейнерах
- Отключать подтверждения на деструктивные операции

---

## 5. Управление контекстом

**DO:**
- Пиши спецификацию перед реализацией (15 мин спеки экономят часы переделок)
- Иерархия: Constitution (~400 строк) -> Спецификация -> Trace
- Держи артефакты актуальными -- устаревшая документация хуже отсутствия

**DON'T:**
- "Сделай как-нибудь" без спецификации
- 4000 строк воды вместо 400 строк полезного контекста
- Забывать trace-файлы -- без них знания теряются между сессиями

---

## 6. MCP

**DO:**
- Принцип наименьших привилегий: Git read-only, БД SELECT only
- Проверяй environment variables -- MCP видит только то, что в env

**DON'T:**
- MCP к production БД без read-only ограничений
- 10+ серверов одновременно -- контекст перегружается
- DELETE/UPDATE права без явной необходимости

---

## 7. Параллельные агенты

**DO:**
- git worktree для каждого параллельного агента
- Runbook перед запуском: задачи, порядок, критерии приемки
- Мониторинг: heartbeat, метрики, логи

**DON'T:**
- Параллельные агенты без изоляции -- гарантированные конфликты
- "Декомпозируй и сделай сам" -- декомпозицию делает человек
- Игнорировать merge-конфликты

---

## 8. Безопасность

**DO:**
- `.gitignore` для `.env`, `secrets/`, `*.pem`, `credentials.json`
- `--exclude "**/.env,**/secrets/**"` в AGENTS.md
- Pre-commit hooks: `grep -r "password\s*=\s*['\"]"`, `npm audit`, `pip-audit`
- Агенты в Docker-контейнерах (sandboxing)
- Логирование всех действий агента (trace-файлы)
- Принцип наименьших привилегий для MCP и внешних сервисов

**DON'T:**
- Захардкоженные секреты в промпте и коде: `API_KEY = "sk-ant-..."`
- SQL без параметризации: `f"SELECT * FROM users WHERE id={user_id}"`
- YOLO-режим без sandbox

---

## 9. Конфиденциальность

**Никогда не отправляй в ИИ:**

| Данные | Риск |
|--------|------|
| API-ключи, токены, пароли | Утечка credentials |
| `.env` файлы | Доступ к инфраструктуре |
| PII (email, телефоны, адреса) | GDPR: штраф до 20M EUR |
| Медицинские данные | HIPAA: штраф до $1.5M/год |
| NDA-документы | Юридическая ответственность |
| Session tokens, JWT, cookies | Захват сессий |
| Внутренние credentials клиентов | Репутационный и юридический ущерб |

**DO:**
- Sanitize данные перед отправкой агенту -- убирай реальные имена, email, ключи
- Используй заглушки (`REDACTED`, `example@test.com`) в промптах с примерами данных
- Проверяй, что агент не включил чувствительные данные в коммит или лог
- Соблюдай политику информационной безопасности компании при работе с любым ИИ

**DON'T:**
- Копировать production логи с PII в промпт
- Давать агенту доступ к production secrets через env
- Использовать реальные данные клиентов в тестовых примерах для ИИ
- Предполагать, что "локальная модель" = "безопасно" -- утечки возможны через логи и кэш

---

## 10. Контроль качества

**Код от ИИ = твой код. Ты несёшь ответственность.**

**DO:**
- Читай каждую строку перед коммитом -- понимай, что коммитишь
- Запускай линтер, type checker, тесты после каждого изменения агента
- Проверяй edge cases -- агент оптимизирует happy path, пропускает edge cases 
- Проверяй, что агент не сломал существующий код (регрессия)
- Self-consistency: попроси агента проверить собственное решение. Также используй отдельного агента-ревьюера

**DON'T:**
- Мержить без ревью "потому что тесты зелёные"
- Доверять агенту на слово -- модели галлюцинируют
- Игнорировать sycophancy -- модель соглашается с тобой, даже если ты неправ
- Коммитить код, который ты не понимаешь

---

## 11. Атрибуция и прозрачность

**DO:**
- `Co-Authored-By: Claude <noreply@anthropic.com>` в коммитах
- Маркируй PR от агентов
- Логируй: какой агент, какая модель, какая задача

**DON'T:**
- Выдавать код агента за полностью свой
- Скрывать использование ИИ от команды
