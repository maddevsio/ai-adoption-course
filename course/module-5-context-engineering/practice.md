# Практические упражнения по SDD и управлению артефактами

Этот практикум поможет вам освоить Spec-Driven Development на практике: изучить источники, установить skills, создать систему артефактов и реализовать фичу по спецификации.

**Время выполнения:** 50 минут

## Чек-лист готовности

Перед началом убедитесь что:
- [ ] Вы изучили theory.md Модуля 5
- [ ] Claude Code установлен и работает
- [ ] Песочница task-manager или ваш проект готовы
- [ ] Есть 50 минут для упражнений

**Предварительные требования:**
- Изучен [theory.md](./theory.md) модуля 5
- Установлен Claude Code или другой AI coding agent
- Есть тестовый проект для практики

---

## Подготовка: Изучить источники и установить skills (10 мин)

### Список источников по SDD для чтения

Изучите эти материалы, чтобы понять теорию и практику Spec-Driven Development:

1. **[Building a C compiler with a team of parallel Claudes](https://www.anthropic.com/engineering/building-c-compiler)** (Anthropic, февраль 2026)
   - Кейс: 16 параллельных агентов Claude Opus 4.6 написали C-компилятор на Rust
   - 100,000 строк кода, 2000 сессий, $20,000 API-запросов
   - Компилятор проходит 99% GCC torture test suite и компилирует Linux 6.9
   - **Ключевой урок:** test-driven development как форма SDD — тесты были спецификацией для агентов

2. **[Spec-driven development](https://www.thoughtworks.com/en-us/insights/blog/agile-engineering-practices/spec-driven-development-unpacking-2025-new-engineering-practices)** (Thoughtworks, 2025)
   - Определение SDD и его принципы
   - Отличие от традиционной разработки
   - Как писать эффективные спецификации для AI-агентов
   - Связь SDD с TDD и BDD

3. **[Understanding SDD: Kiro, spec-kit, Tessl](https://martinfowler.com/articles/exploring-gen-ai/sdd-3-tools.html)** (Martin Fowler, 2025)
   - Сравнение трёх SDD-инструментов
   - Три уровня строгости спецификации: легковесная, структурированная, формальная
   - Когда использовать каждый подход
   - Практические рекомендации по выбору инструментов

### Примеры конституций из реальных проектов

Изучите, как ведущие проекты документируют контекст для AI-агентов:

1. **[Next.js AGENTS.md](https://github.com/vercel/next.js/blob/canary/AGENTS.md)**
   - Эталон конституции для крупного монорепозитория
   - Структура: архитектура, конвенции, паттерны, запреты
   - Обратите внимание на раздел "Build & Test" — как агенту проверить работоспособность

2. **[Anthropic claude-code-action CLAUDE.md](https://github.com/anthropics/claude-code-action/blob/main/CLAUDE.md)**
   - Конституция от создателей Claude
   - Секция "Things That Will Bite You" — типичные ошибки агентов
   - Примеры того, как НЕ надо делать

3. **[GitHub Spec Kit AGENTS.md](https://github.com/github/spec-kit/blob/main/AGENTS.md)**
   - Конституция SDD-тулкита от GitHub
   - Чёткая иерархия: constitution → specs → plans → tasks
   - Паттерн "field notes → consolidation"

4. **[awesome-claude-md](https://github.com/josix/awesome-claude-md)**
   - Коллекция AGENTS.md и CLAUDE.md из десятков проектов
   - Анализ общих паттернов и best practices
   - Используйте для вдохновения при создании своей конституции

### Skills для установки

Skills — это переиспользуемые промпты для повторяющихся задач. Установите эти skills и изучите, как они работают:

#### 1. cc-sdd — полный SDD-workflow

**Репозиторий:** https://github.com/gotalab/cc-sdd

**Что делает:** Полный SDD-цикл для Claude Code: requirements → design → tasks → implementation

**Команды (11 slash-команд):**
- `/kiro:spec-init` — инициализация новой спецификации
- `/kiro:spec-requirements` — сбор требований
- `/kiro:spec-design` — проектирование архитектуры
- `/kiro:spec-tasks` — декомпозиция на задачи
- `/kiro:spec-impl` — реализация по спецификации
- `/kiro:spec-test` — генерация тестов
- `/kiro:spec-review` — ревью кода
- `/kiro:spec-doc` — документация
- `/kiro:spec-validate` — валидация спецификации
- `/kiro:spec-export` — экспорт артефактов
- `/kiro:spec-status` — статус выполнения

**Установка:**
```bash
# Установка skill в Claude Code
npx cc-sdd@latest --claude --lang ru

# Проверка установки
ls ~/.claude/skills/
# Должна появиться директория kiro/
```

**Проверка работы:**
1. Откройте Claude Code в тестовом проекте
2. Введите `/kiro:spec-init`
3. Следуйте инструкциям агента для создания первой спецификации

**Troubleshooting при установке:**

**Ошибка: "command not found: npx"**
- Установите Node.js: https://nodejs.org/
- Проверьте: `node --version` и `npm --version`

**Ошибка: "permission denied"**
- Используйте без sudo (skills устанавливаются в ~/.claude/skills/)
- Если не помогло: `chmod -R u+w ~/.claude/`

**Ошибка: "skill not found после установки"**
- Перезапустите Claude Code
- Проверьте: `ls ~/.claude/skills/` — должна быть папка kiro/
- Убедитесь что файл ~/.claude/skills/kiro/skill.json существует

#### 2. GitHub Spec Kit — конституция, спеки, планы

**Репозиторий:** https://github.com/github/spec-kit

**Что делает:** Официальный SDD-тулкит от GitHub — управление конституцией, спецификациями, планами и задачами с чеклистами

**Команды:**
- `/speckit.constitution` — создание/обновление конституции проекта
- `/speckit.specify` — написание спецификации фичи
- `/speckit.plan` — декомпозиция спецификации на план работ
- `/speckit.tasks` — создание задач с чеклистами
- `/speckit.implement` — реализация по спецификации

**Установка:**
```bash
# Установка CLI
uv tool install specify-cli --from git+https://github.com/github/spec-kit.git

# Инициализация проекта
cd /path/to/your/project
specify init my-project --ai claude

# Это создаст:
# - .speckit/constitution.md
# - .speckit/specs/ (директория для спецификаций)
# - .speckit/plans/ (директория для планов)
```

**Проверка работы:**
1. Запустите `specify init test-project --ai claude` в пустой директории
2. Проверьте, что создалась структура `.speckit/`
3. Откройте `constitution.md` и изучите шаблон
4. В Claude Code введите `/speckit.specify` для создания первой спецификации

**Примечание:** Spec Kit требует `uv` (Python package manager). Если у вас его нет:
```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

#### 3. claude-skills-starter — 12 slash-команд для Claude Code

**Репозиторий:** https://github.com/angakh/claude-skills-starter

**Что делает:** Готовый набор из 12 полезных slash-команд для Claude Code

**Команды:**
- `/commit` — создание коммита с conventional commits
- `/quality` — code review по чеклисту
- `/scaffold` — генерация boilerplate кода
- `/test` — написание тестов с полным покрытием
- `/pr-create` — создание pull request с шаблоном
- `/refactor` — рефакторинг с сохранением поведения
- `/debug` — диагностика и исправление ошибок
- `/docs` — генерация документации
- `/security` — аудит безопасности
- `/performance` — анализ производительности
- `/deploy` — подготовка к деплою
- `/review-pr` — ревью чужого PR

**Установка:**
```bash
# Клонируйте репозиторий
git clone https://github.com/angakh/claude-skills-starter.git

# Скопируйте .claude/ в корень вашего проекта
cp -r claude-skills-starter/.claude /path/to/your/project/

# Или установите глобально
cp -r claude-skills-starter/.claude ~/.claude/
```

**Проверка работы:**
1. Откройте Claude Code в проекте с установленными skills
2. Введите `/commit` — агент должен предложить создать коммит
3. Введите `/quality` — агент запустит code review
4. Проверьте список доступных skills командой `/help`

### Задание

1. Прочитайте все три источника по SDD (20-30 минут на всё)
2. Изучите минимум 2 примера конституций из списка
3. Установите минимум 2 skill из предложенных
4. Протестируйте каждый установленный skill на простой задаче
5. Зафиксируйте заметки:
   - Какие идеи из источников показались наиболее ценными?
   - Какие паттерны повторяются в разных конституциях?
   - Какой skill показался наиболее полезным для вашего workflow?

---

## Шаг 1: Конституция проекта (10 мин)

Конституция проекта (Project Constitution) — это "память" агента, которая сохраняется между сессиями. Она содержит контекст, необходимый агенту для принятия правильных решений.

### Теория

**Что такое конституция?**

Это живой документ ~400-500 строк, обязательный к прочтению перед любой работой. Содержит:
- **Tech Stack:** точные версии используемых технологий
- **Architecture Decisions (ADR):** принятые архитектурные решения, которые нельзя менять без согласования
- **Patterns:** обязательные паттерны для типовых задач
- **Antipatterns:** что категорически запрещено
- **Conventions:** соглашения по именованию, структуре, стилю

**Почему это важно?**

AI-агент не имеет памяти между сессиями. Без конституции каждая новая сессия превращается в археологические раскопки: агент читает код, гадает по структуре, делает неверные предположения. Конституция решает эту проблему — агент знает контекст с первой минуты.

**Бюджет контекста:**

Ориентир ~400-500 строк, но главное — **полезность**, а не размер. Каждая строка должна помогать агенту принять правильное решение. Если информация не влияет на решения — удаляйте её.

**Что включать:**
- Tech stack с точными версиями (Go 1.22, PostgreSQL 16)
- Обязательные паттерны с примерами кода
- Antipatterns — что запрещено и почему
- ADR — решения, которые нельзя менять

**Что НЕ включать:**
- Code style guidelines (используйте линтер)
- Полную документацию API (ссылка на Swagger достаточно)
- Tutorial "как работать с Git" (агент это знает)
- Историю решений (для этого есть decision log)

### Шаблон конституции

Используйте файл [templates/constitution-template.md](./templates/constitution-template.md) как основу.

### Задание

1. Откройте шаблон конституции в [templates/constitution-template.md](./templates/constitution-template.md)
2. Выберите свой проект (или создайте учебный)
3. Заполните все секции шаблона для вашего проекта:
   - **Project Overview:** название, назначение, статус
   - **Tech Stack:** используемые технологии с версиями
   - **Architecture Decisions:** 1-2 ключевых решения (например, "почему выбрали PostgreSQL", "почему монолит, а не микросервисы")
   - **Patterns:** 2-3 обязательных паттерна (например, "все handlers возвращают Result<T, Error>")
   - **Antipatterns:** 2-3 запрета (например, "не использовать var, только let/const")
   - **Conventions:** правила именования, структура файлов
4. Сохраните конституцию в файл `AGENTS.md` или `CLAUDE.md` в корне проекта
5. Проверка: попросите агента прочитать конституцию и объяснить, какие паттерны обязательны для проекта

**Пример промпта для проверки:**
```
Прочитай AGENTS.md в корне проекта. Какие паттерны обязательны для этого проекта?
Какие antipatterns запрещены? Кратко перечисли основные правила.
```

Если агент правильно пересказал ключевые моменты — конституция работает.

---

## Шаг 2: Спецификация фичи (15 мин)

Спецификация (spec) — это чёткое техническое задание для агента. Вместо размытого "сделай фичу" вы пишете структурированный документ: что нужно, как должно работать, какие ограничения, какие тесты.

### Теория

**Почему спецификация важна?**

AI-модели обучены на миллиардах примеров кода. Они отлично умеют переводить спецификацию в код, если спецификация чёткая. Проблема не в том, что модель не может написать код — проблема в том, что она не знает, *какой* код вы хотите.

**Структура хорошей спецификации:**

1. **Цель:** что делает фича, зачем она нужна (1-2 предложения)
2. **Acceptance Criteria:** чёткие критерии готовности (чеклист)
3. **Технические ограничения:** какие технологии использовать, какие паттерны применять
4. **Примеры использования:** API примеры, UI примеры, edge cases
5. **Out of Scope:** что явно НЕ входит в задачу (чтобы агент не додумывал лишнего)

**Уровни детализации:**

- **Легковесная спецификация:** 10-15 строк для простого endpoint
- **Структурированная:** 1-2 страницы для модуля
- **Формальная:** несколько страниц для сложной системы с state machine

Начинайте с легковесной, усиливайте по необходимости.

### Подготовленный сценарий

**Фича:** Добавить фильтрацию задач по статусу и приоритету в TODO-приложение

**Контекст:**
- У вас есть простое TODO-приложение (или API для задач)
- Есть список задач с полями: `id`, `title`, `description`, `status` (pending/in_progress/done), `priority` (low/medium/high)
- Нужно добавить возможность фильтрации списка задач

### Шаблон спецификации

Используйте файл [templates/feature-spec-template.md](./templates/feature-spec-template.md) как основу.

### Задание

1. Откройте шаблон спецификации в [templates/feature-spec-template.md](./templates/feature-spec-template.md)
2. Заполните шаблон для фичи "Фильтрация задач по статусу и приоритету":
   - **Цель:** что делает фича (например, "Пользователь может фильтровать список задач по статусу и/или приоритету")
   - **Acceptance Criteria:** минимум 4-5 критериев (например, "фильтрация работает по одному параметру", "фильтрация работает по двум параметрам одновременно", "пустой фильтр возвращает все задачи")
   - **Технические ограничения:** технологии, паттерны (например, "использовать query parameters для фильтров", "следовать REST conventions")
   - **Примеры API:** покажите примеры запросов и ответов
   - **Out of Scope:** что НЕ делаем (например, "сортировка", "пагинация", "поиск по тексту")
3. Сохраните спецификацию в файл (например, `specs/task-filtering.spec.md`)
4. Проверка: покажите спецификацию другому человеку (или агенту) — понятно ли, что нужно сделать?

**Критерии качественной спецификации:**
- Любой разработчик (или агент) понимает, что делать
- Нет двусмысленности в формулировках
- Есть конкретные примеры
- Понятно, когда задача выполнена (acceptance criteria)

---

## Шаг 3: Реализация по спецификации (10 мин)

Теперь дайте агенту спецификацию и конституцию — и пусть он реализует фичу.

### Теория

**Как работает SDD-цикл:**

1. Пишете спецификацию (вы)
2. Даёте агенту спецификацию + конституцию (вы)
3. Агент реализует код по спецификации
4. Агент пишет тесты
5. Агент запускает тесты и проверяет compliance
6. Вы делаете ревью: спецификация выполнена? Criteria met?
7. Итерация до готовности
8. Агент создаёт trace с заметками

**Промпт для агента:**

Ключевой принцип: агент должен **сначала прочитать** конституцию и спецификацию, **потом** писать код.

### Шаблон промпта

```markdown
Прочитай следующие файлы:

1. AGENTS.md (или CLAUDE.md) — конституция проекта
2. specs/task-filtering.spec.md — спецификация фичи

Затем реализуй фичу согласно спецификации:

- Следуй всем паттернам из конституции
- Выполни все acceptance criteria из спецификации
- Напиши тесты для каждого критерия
- Запусти тесты и убедись, что они проходят
- Не реализуй то, что в "Out of Scope"

После реализации доложи:
- Какие файлы изменил/создал
- Какие acceptance criteria выполнены
- Результаты тестов
```

### Задание

1. Откройте Claude Code (или другой AI coding agent) в вашем проекте
2. Дайте агенту промпт из шаблона выше
3. Дождитесь реализации
4. Сделайте ревью по чеклисту:

**Чеклист ревью:**

- [ ] Агент прочитал конституцию перед началом работы?
- [ ] Агент прочитал спецификацию?
- [ ] Все acceptance criteria выполнены?
- [ ] Код следует паттернам из конституции?
- [ ] Есть тесты для каждого acceptance criteria?
- [ ] Тесты проходят?
- [ ] Агент НЕ реализовал то, что в "Out of Scope"?
- [ ] Код работает на примерах из спецификации?

Если хотя бы один пункт не выполнен — дайте агенту feedback и попросите исправить.

**Пример feedback:**
```
Ревью: Acceptance criteria #3 ("фильтрация по двум параметрам одновременно")
не покрыт тестами. Добавь тест для случая ?status=pending&priority=high
```

5. Когда все пункты чеклиста выполнены — фича готова

### Типичные ошибки агентов

**Ошибка 1:** Агент не прочитал конституцию и использовал неправильный паттерн

**Решение:** Явно требуйте в промпте: "Сначала прочитай AGENTS.md, затем пиши код"

**Ошибка 2:** Агент реализовал то, что в "Out of Scope"

**Решение:** Усильте секцию "Out of Scope" в спецификации, явно запретите лишнее

**Ошибка 3:** Агент написал код, но не тесты

**Решение:** Добавьте в acceptance criteria: "Есть тесты для каждого сценария"

**Ошибка 4:** Тесты есть, но не проходят

**Решение:** Требуйте от агента: "Запусти тесты и убедись, что они проходят, прежде чем докладывать о готовности"

---

## Шаг 4: Заметки по реализации (5 мин)

После реализации агент должен создать trace — документ с заметками о том, что сделано, какие решения приняты, что пошло не так.

### Теория

**Что такое trace?**

Trace (заметки по реализации) — это документ, который агент создаёт после выполнения плана или спецификации. Фиксирует:
- Что сделано (кратко)
- Технические решения (почему выбрали A вместо B)
- Проблемы и их решения (что пошло не так, как исправили)
- Для конституции (что стоит добавить в constitution для будущих агентов)

**Зачем это нужно?**

Traces — это эволюционная память проекта. Следующий агент (или вы через месяц) прочитает trace и поймёт:
- Почему реализация выглядит именно так
- Какие альтернативы рассматривались
- Какие проблемы возникали и как их решили
- Что стоит зафиксировать в конституции

**Цикл накопления знаний:**

```
Agent работает → пишет trace → reflect-mode читает traces →
обновляет constitution → следующий agent читает constitution
```

Traces → Constitution — это паттерн "field notes → consolidation". Агенты не пишут напрямую в constitution (это защищает от случайной порчи), они создают traces с предложениями.

### Шаблон заметок

Используйте файл [templates/implementation-notes-template.md](./templates/implementation-notes-template.md) как основу.

### Задание

1. Откройте шаблон заметок в [templates/implementation-notes-template.md](./templates/implementation-notes-template.md)
2. Попросите агента заполнить trace для реализованной фичи:

**Промпт для агента:**
```markdown
Создай trace файл для реализованной фичи "Фильтрация задач"
по шаблону templates/implementation-notes-template.md.

Заполни все секции:

1. Что сделано — краткое описание результата
2. Что сделано хорошо — что получилось особенно удачно
3. Что не так / что улучшить — проблемы, которые возникли
4. Технические решения — почему выбрали именно такую реализацию
5. Для конституции — что стоит добавить в AGENTS.md для будущих задач

Сохрани trace в файл traces/task-filtering.trace.md
```

3. Проверьте созданный trace:
   - Есть ли конкретика? (не "всё хорошо", а "query parsing через URLSearchParams работает корректно")
   - Есть ли анализ проблем? (что пошло не так и почему)
   - Есть ли предложения для конституции? (что стоит зафиксировать)

4. Обновите конституцию на основе trace:
   - Прочитайте секцию "Для конституции"
   - Добавьте ценные находки в AGENTS.md (если они действительно важны)
   - Не добавляйте очевидное или избыточное

**Критерии качественного trace:**

- Конкретика, а не общие слова
- Технические решения с обоснованием
- Проблемы и их причины (не просто "была ошибка", а "ошибка была из-за...")
- Предложения для конституции (что поможет следующему агенту)

### Пример хорошего trace

Посмотрите пример из проекта **Enji Fleet** (учебный проект Mad Devs): `/home/user/enji-fleet/docs/traces/2026-02-05-mvp-store-service.trace.md` (примечание: доступ к файлам проекта предоставляется студентам курса)

Обратите внимание:
- Секция "Что сделано" — конкретный список задач
- Секция "Что узнал" — технические детали (toolchain 1.24.x, checksum как JSON)
- Секция "Проблемы" — конкретные проблемы с обоснованием
- Секция "Для конституции" — что стоит зафиксировать для будущих агентов

---

## Резюме и следующие шаги

### Что вы изучили

1. **Источники по SDD:** теория и практика Spec-Driven Development
2. **Примеры конституций:** как ведущие проекты документируют контекст для AI
3. **Skills:** готовые инструменты для SDD-workflow
4. **Конституция проекта:** как создать "память" для агентов
5. **Спецификация фичи:** как писать чёткие технические задания
6. **Реализация по спецификации:** как дать агенту контекст и проверить результат
7. **Заметки по реализации:** как накапливать знания через traces

### SDD-цикл

```
Вы пишете спецификацию
        ↓
Агент читает constitution + spec
        ↓
Агент реализует код + тесты
        ↓
Агент проверяет compliance (тесты, линтеры)
        ↓
Вы делаете ревью (acceptance criteria met?)
        ↓
Итерация до готовности
        ↓
Агент создаёт trace с заметками
        ↓
Вы обновляете constitution на основе trace
```

### Прогрессия зрелости

**Уровень 1: Нет документации**
- Агент гадает по коду
- Каждая сессия — археологические раскопки

**Уровень 2: AGENTS.md в корне**
- Агент знает tech stack, конвенции
- Один файл ~50-100 строк
- Подходит для pet-проектов

**Уровень 3: AGENTS.md + Memory Bank**
- Тематические файлы (auth.md, database.md)
- Агент загружает только релевантное
- Подходит для средних проектов (5-10K LOC)

**Уровень 4: Constitution + Plans + Traces**
- Полноценная иерархия артефактов
- История решений, цикл накопления знаний
- Подходит для больших проектов

**Уровень 5: Skills + Workflows**
- Специализация агентов (developer, architect, reviewer)
- Оркестрация через платформу
- Примеры подходов: **Enji Fleet** (учебный проект Mad Devs), GitHub Copilot Workspace

Не прыгайте сразу на уровень 5. Начните с AGENTS.md, добавляйте артефакты по мере роста проекта.

### Следующие шаги

1. **Примените на реальном проекте:**
   - Создайте AGENTS.md для вашего проекта
   - Напишите спецификацию следующей фичи
   - Реализуйте по SDD-циклу

2. **Изучите продвинутые техники:**
   - Memory Bank паттерн (тематические файлы)
   - Reflect-mode агент (консолидация знаний)
   - Decision Log (журнал архитектурных решений)

3. **Экспериментируйте с инструментами:**
   - Попробуйте разные skills
   - Сравните легковесную vs формальную спецификацию
   - Найдите баланс детализации для вашего проекта

4. **Делитесь опытом:**
   - Публикуйте свои конституции (awesome-claude-md)
   - Создавайте skills для повторяющихся задач
   - Документируйте паттерны и antipatterns

### Полезные ссылки

**Стандарты:**
- [AGENTS.md specification](https://agents.md/) — открытый стандарт для AI-агентов

**Коллекции:**
- [awesome-claude-md](https://github.com/josix/awesome-claude-md) — примеры конституций
- [awesome-cursorrules](https://github.com/PatrickJS/awesome-cursorrules) — .cursorrules для Cursor
- [awesome-claude-code](https://github.com/hesreallyhim/awesome-claude-code) — skills для Claude Code

**Инструменты:**
- [cc-sdd](https://github.com/gotalab/cc-sdd) — SDD-workflow для Claude Code
- [GitHub Spec Kit](https://github.com/github/spec-kit) — SDD-тулкит от GitHub
- [claude-skills-starter](https://github.com/angakh/claude-skills-starter) — starter pack skills

**Статьи:**
- [Creating the Perfect CLAUDE.md](https://dometrain.com/blog/creating-the-perfect-claudemd-for-claude-code/) — Dometrain
- [Spec-driven development with AI](https://github.blog/ai-and-ml/generative-ai/spec-driven-development-with-ai-get-started-with-a-new-open-source-toolkit/) — GitHub Blog

---

## Обратная связь

После выполнения практикума ответьте на вопросы:

1. Какой шаг оказался самым сложным? Почему?
2. Какие паттерны из конституций реальных проектов показались наиболее ценными?
3. Изменилось ли ваше представление о том, как работать с AI-агентами?
4. Какие skills оказались наиболее полезными?
5. Планируете ли вы применить SDD в своих проектах? Если да, с чего начнёте?

Зафиксируйте ответы — это поможет осознать изученное и спланировать дальнейшее изучение.
