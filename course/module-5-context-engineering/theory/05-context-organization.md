[← Оглавление](../../../README.md)

## 10. Организация контекста в проекте

Практики:

- **README:** высокоуровневое описание проекта, как запустить, как контрибьютить
- **AGENTS.md / CLAUDE.md:** детальный контекст для агентов — архитектура, build steps, конвенции
- **docs/:** отдельные документы для сложных систем — architecture.md, api.md, deployment.md
- **Чистая структура папок:** агент не должен гадать, где что лежит

Контекстное окно ограничено — пишите структурированные чеклисты, не 10-страничные доклады.

### 10.1. Бюджет контекста

**Бюджет constitution:** ориентир ~400-500 строк, но главное — полезность. Каждая строка должна помогать агенту принять решение.

> [!NOTE] 400-500 строк — ориентир для старта. По мере развития проекта конституция растёт. Конституция Enji Fleet достигла ~800 строк за 23 плана. Это нормально — главное, чтобы каждая строка была полезной.

**Что включать:**
- Tech stack с точными версиями (Go 1.22, PostgreSQL 16)
- Обязательные паттерны (Repository pattern, error handling)
- Antipatterns — что категорически запрещено
- Примеры кода для типичных задач

**Что НЕ включать:**
- Code style guidelines (используйте линтер)
- Полную документацию API (ссылка на Swagger достаточно)
- Tutorial "как работать с Git" (агент это знает)

### 10.2. Структурирование для быстрого поиска

Агенты используют grep и семантический поиск для навигации по документам. Помогите им:
- Используйте чёткие заголовки (## Authentication, ## Database Patterns)
- Выделяйте ключевые слова жирным (**ОБЯЗАТЕЛЬНО**, **ЗАПРЕЩЕНО**)
- Группируйте связанную информацию в списки и таблицы
- Добавляйте примеры кода рядом с правилами

Агент не читает документы линейно — он ищет релевантные секции.

### 10.3. Версионирование артефактов

Артефакты живут в git. История изменений — история решений.

- Все артефакты в git: constitution, plans, traces
- Промпты, которые дали хороший результат, сохраняются в отдельной директории (`prompts/`)
- Изменения в constitution через pull requests с ревью
- Trace файлы создаются вместе с PR, который они описывают

## 11. Блокирующие правила для агентов

Система артефактов работает только если агенты **обязаны** их создавать. "Опционально" = "не делать".

### 11.1. Формулировки имеют значение

- "Опционально обнови constitution" --> "Заполни секцию 'Для конституции' в trace — **ОБЯЗАТЕЛЬНО**"
- "Smoke test проходит" --> "Smoke test: Create -> ID, Get -> object, Delete -> 404"
- "Напиши тесты" --> "Каждый endpoint покрыт минимум 1 integration тестом. Coverage > 80%"
- "Задокументируй решения" --> "Таблица технических решений в trace: # | Решение | Причина"

Агент оптимизирован на скорость решения задачи, а не качество.

## 12. Уровни зрелости

Не нужно сразу прыгать на максимальный уровень. Начните с AGENTS.md, добавляйте артефакты по мере роста проекта.

**Уровень 1:** Нет документации. Агент гадает по коду.

**Уровень 2:** AGENTS.md в корне. Агент знает основы: tech stack, как запустить проект, базовые конвенции. Подходит для pet-проектов и MVP.

**Уровень 3:** AGENTS.md + traces. Агент имеет доступ к тематическим файлам. Подходит для средних проектов (5-10K строк).

**Уровень 4:** Constitution + Plans + Traces. Полноценная иерархия артефактов. Агент знает не только "как", но и "почему". Для больших проектов.

Реальные цифры из Enji Fleet (7 микросервисов + фронтенд):

| Артефакт | Количество | Общий объём |
|----------|-----------|-------------|
| Plans | 23 файла | ~32,000 строк |
| Traces | 43 файла | ~6,200 строк |
| Fails | 7 файлов | ~600 строк |
| Specs | 17 файлов | ~8,000 строк |
| Constitution | 1 файл | ~800 строк |
| Decisions | 1 файл | ~700 строк |

### Практические советы

1. **Напишите AGENTS.md** с минимальным контекстом: tech stack, как запустить проект, основные правила.
2. **Создайте первую версию конституции**. Сделайте ее обязательной для прочтения всеми агентами.
3. **Создайте первую спецификацию** для следующей фичи. 15 минут на чёткое описание сэкономят 2 часа объяснений агенту.
4. **Заведите директорию для traces** и укажите в конституции, что агент должен создавать trace после каждой задачи.
5. **Когда traces накопятся** (5-10 файлов), выделите время на консолидацию. Какие паттерны повторяются? Что стоит добавить в AGENTS.md?
6. **Версионируйте всё.** Артефакты в git = история мышления проекта.
7. **Настройте автоматизацию.** Выдайте роли агентам, которые будут обслуживать контекст в проекте без вашего вовлечения.

**Чего избегать:**
- **Не дублируйте код в документации.**
- 400 строк полезного контекста лучше 4000 строк воды.
- **Не превращайте AGENTS.md в линтер.** Code style проверяется автоматически.
- **Не забывайте обновлять.** Устаревшая документация хуже её отсутствия.

---

## Источники

- [Understanding Spec-Driven-Development: Kiro, spec-kit, and Tessl](https://martinfowler.com/articles/exploring-gen-ai/sdd-3-tools.html) — Martin Fowler
- [Context Engineering for AI Agents](https://www.linkedin.com/pulse/context-engineering-ai-agents-tobi-lutke/) — Tobi Lutke (CEO Shopify)
- [AGENTS.md specification](https://agents.md/) — открытый формат для инструкций AI-агентам
- [Creating the Perfect CLAUDE.md for Claude Code](https://dometrain.com/blog/creating-the-perfect-claudemd-for-claude-code/) — Dometrain
- [GitHub Spec Kit announcement](https://github.blog/ai-and-ml/generative-ai/spec-driven-development-with-ai-get-started-with-a-new-open-source-toolkit/) — GitHub Blog
---

[← 7. AGENTS.md / CLAUDE.md](04-special-artifacts.md) | [Оглавление](../../../README.md) | [Подготовка: Изучить источники и установить skills (10 мин) →](../practice/01-sources-and-skills.md)
