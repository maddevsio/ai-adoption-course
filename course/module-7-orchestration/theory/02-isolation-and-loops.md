[← Оглавление](../../../README.md)

## 3. Изоляция контекстов с git worktree

Каждый агент работает в своей сессии, со своим контекстом. Если два агента одновременно редактируют файлы в одной директории, они могут перезаписать изменения друг друга или получить конфликты merge.

**Git worktree** — простое решение: одна копия репозитория → несколько рабочих директорий → каждый агент работает в своей.

> [Диаграмма: Git Worktree — изоляция агентов](../diagrams/git-worktree.md)

```bash
# Создать worktree для агента
git worktree add ../myproject-add-user-auth -b feat/add-user-auth

# Агент работает здесь: пишет код, коммитит, создаёт PR

# После завершения работы удалить worktree
git worktree remove ../myproject-add-user-auth
```

Worktree создаёт отдельную рабочую директорию, привязанную к новой ветке. Это не клон репозитория (история общая), но файловая система изолирована.

## 4. Ralph Loop и fail-until-done

Агент не должен останавливаться при первой ошибке. Человек должен вовлекаться только, если агент либо выполнил задачу, либо застрял (провалил несколько итераций) 

**Ralph Loop** — паттерн автономной работы: цикл Do → Check → Fix → повторять до успеха.

> [Диаграмма: Ralph Loop — цикл Do -> Check -> Fix](../diagrams/ralph-loop.md)

**Цикл:**
1. **Do** — агент выполняет задачу (пишет код, создаёт файлы)
2. **Check** — запускаются проверки (тесты, линтер, билд)
3. **Fix** — если проверка упала, агент анализирует ошибку и исправляет
4. Цикл повторяется до тех пор, пока все проверки не пройдут

Критерий остановки — не "я написал код", а "все тесты зелёные, линтер молчит, билд успешен".

**Fail-until-done** — агент работает в цикле до достижения успеха, не останавливаясь при первой ошибке. Нет понятия "я попробовал и не вышло". Есть понятие "я буду пробовать, пока не получится, или пока не упрусь в hard limit" (например, 50 итераций или 3 часа работы).

Ralph Loop работает при формализованных критериях. «Код должен выглядеть красиво» — непроверяемо. «Все тесты пройдены, coverage > 80%» — проверяемо.

Ссылки:
- https://ghuntley.com/ralph/ — оригинальная концепция
- https://dev.to/alexandergekov/2026-the-year-of-the-ralph-loop-agent-1gkj — почему Ralph Loop стал стандартом
---

[← Модуль 7: Параллельные агенты и оркестрация](01-role-and-parallelism.md) | [Оглавление](../../../README.md) | [5. Ролевая модель агентов →](03-roles-and-patterns.md)
