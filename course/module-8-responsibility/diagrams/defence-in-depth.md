# Defence in Depth: многослойная защита

Безопасность — это не одна мера, а комбинация слоев. Каждый слой ловит то, что пропустил предыдущий. Если скомпрометирован один слой — остальные все еще защищают.

```mermaid
flowchart TD
    Agent["AI-агент\nвыполняет задачу"]

    S1["Слой 1: Sandboxing\nDocker-контейнер,\nVM, git worktree —\nизолированная среда"]
    S2["Слой 2: Read-only\nМонтировать репозиторий\nreadonly для ревью,\nаудита, анализа"]
    S3["Слой 3: Сеть\nОграничить исходящие\nсоединения: firewall,\nDocker network policies"]
    S4["Слой 4: Whitelist\nЯвно указать разрешенные\nкоманды: git, npm, pytest.\nНе blacklist!"]
    S5["Слой 5: Аудит\nЛогировать все действия:\nкоманды, файлы, решения.\nTrace-файлы для разбора"]

    Agent --> S1 --> S2 --> S3 --> S4 --> S5 --> Protected["Защищенная\nсистема"]
```

**Принцип:** каждый слой работает независимо. Даже если агент обошел sandboxing — read-only режим не даст записать. Даже если записал — whitelist не даст выполнить опасную команду. Даже если выполнил — аудит зафиксирует для разбора.
