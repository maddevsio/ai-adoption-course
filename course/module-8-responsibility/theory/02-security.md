[← Оглавление](../../../README.md)

## 2. Безопасность

Агент может читать файлы, выполнять команды, отправлять запросы в сеть. Всё это требует продуманной конфигурации.

> [Диаграмма: Что НЕЛЬЗЯ передавать агенту](../diagrams/forbidden-data.md)

### Что НЕЛЬЗЯ отправлять в контекст ИИ

Промпты или файлы, доступные агенту, не должны содержать:

- **API-ключи, токены доступа, пароли** — даже если модель не сохраняет их намеренно, они могут утечь через логи или историю чата
- **Содержимое `.env` файлов**
- **Приватные данные клиентов (PII)** — email, телефоны, адреса, медицинские и финансовые записи. Нарушение GDPR/HIPAA может стоить очень больших денег
- **Внутренние документы с NDA** — корпоративная стратегия, нераскрытые продукты, финансовые показатели
- **Конфиденциальный код** — некоторые проекты запрещают передачу кода третьим сторонам, включая AI-провайдеров

**Правило:** если потеря данных может привести к компрометации системы, судебным искам или нарушению договоров — это данные не для ИИ.

### Как настроить защиту

Безопасность — это многослойная система. Одного `.gitignore` недостаточно. Нужна комбинация мер.

1. **`.gitignore`** — проверка: `git ls-files | grep -E "secret|key|token|password|\.env"` должна вернуть пустоту

2. **Правила агента** — многие AI CLI поддерживают исключения. Пример для Claude Code: `--exclude "**/.env,**/secrets/**"`. Это не даст агенту случайно прочитать файл, даже если он не в `.gitignore`

3. **Исключения MCP** — настройте ограничения доступа для MCP-серверов (Модуль 6). Пример для MCP filesystem: разрешить чтение только `~/projects/my-app/src`, запретить `~/.ssh`, `~/.aws`, `~/.config`

4. **Ограничение доступа серверов** — используйте read-only режимы где возможно. MCP-сервер для БД — только SELECT, без UPDATE/DELETE. MCP-сервер для Git — только чтение веток, без push

<details>
<summary>Пример из Enji Fleet: безопасное управление credentials</summary>

Credentials управляются через выделенный модуль. Архитектура:

- **Session tokens** для Claude Code, Codex, OpenCode хранятся в отдельных файлах: `~/.claude/auth.json`, `~/.codex/auth.json`, `~/.local/share/opencode/auth.json`
- **Права доступа** — при запуске Fleet SDK устанавливает `chmod 0600` на эти файлы. Только владелец может читать/писать
- **Валидация JSON** перед записью токенов предотвращает ошибки формата и инъекции
- **Изоляция токенов** — каждый AI CLI получает только свой токен через переменную окружения (`CLAUDE_SESSION_TOKEN`, `CODEX_SESSION_TOKEN`)
- **Защита от утечек** — токены никогда не логируются, не передаются в trace-файлы, не попадают в Git

Принцип изоляции: даже если один агент скомпрометирован, он не получит доступ к credentials других агентов.

</details>

### YOLO-мод: удобство vs безопасность

YOLO-мод (You Only Live Once) — режим, когда агент выполняет команды без подтверждения пользователя. Команда `rm -rf node_modules && npm install` выполнится моментально, без вопросов. Удобно для автоматизации, опасно для продакшна.

**Когда допустимо:**
- **Тестовые проекты,** которые можно пересоздать за минуты
- **Изолированные Docker-контейнеры** без доступа к host-системе
- **Одноразовые скрипты** для анализа данных
- **CI/CD пайплайны** с чёткими ограничениями

**Когда категорически нет:**
- **Production БД** — одна команда `DROP TABLE` и всё потеряно
- **Критичные системы** — deployment на продакшн без ревью
- **Проекты с приватными данными** — агент может случайно отправить данные в логи
- **Проекты с денежными операциями** — перевод $10K вместо $100

В **Enji Fleet** YOLO-мод используется только внутри Docker-контейнеров с git worktree. Каждый агент работает в изолированном worktree, который удаляется после завершения.

### Грамотная настройка: defence in depth

> [Диаграмма: Defence in Depth — многослойная защита](../diagrams/defence-in-depth.md)

- **Sandboxing** — запускайте агентов в Docker-контейнерах или виртуальных машинах. Даже если агент скомпрометирован, он ограничен контейнером

- **Read-only режимы** — для ревью кода, анализа архитектуры, аудита безопасности агенту не нужна запись. Монтируйте репозиторий как readonly volume в Docker

- **Ограничение сетевого доступа** — MCP-серверы не должны иметь доступ в интернет без явной необходимости. Если MCP-сервер работает с локальной БД, заблокируйте исходящие соединения через firewall или Docker network policies

- **Whitelist подходы** — явно указывайте, что разрешено ("только git, npm, pytest"). Blacklist всегда неполон, whitelist безопаснее

- **Логирование и аудит** — все действия агентов должны логироваться. В Fleet используются trace-файлы, которые фиксируют процесс: какие команды выполнены, какие файлы изменены, какие решения приняты
---

[← Модуль 8: Ответственное использование ИИ](01-ai-limitations.md) | [Оглавление](../../../README.md) | [3. Ответственность по уровням →](03-responsibility.md)
