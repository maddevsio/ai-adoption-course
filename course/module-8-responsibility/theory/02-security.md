[← Оглавление](../../../README.md)

## 2. Безопасность

Агент может читать файлы, выполнять команды, отправлять запросы в сеть — всё это требует продуманной конфигурации.

> [Диаграмма: Что НЕЛЬЗЯ передавать агенту](../diagrams/forbidden-data.md)

**Что НЕЛЬЗЯ отправлять в контекст ИИ (промпты или файлы, доступные агенту):**

- **API-ключи, токены доступа, пароли** — даже если модель не сохраняет их намеренно, они могут утечь через логи, историю чата или использоваться для обучения будущих моделей
- **Содержимое `.env` файлов**
- **Приватные данные клиентов (PII)** — email, телефоны, адреса, медицинские записи, финансовая информация. Нарушение GDPR и HIPAA может стоить очень больших денег 
- **Внутренние документы с NDA** — корпоративная стратегия, нераскрытые продукты, финансовые показатели
- **Конфиденциальный программный код** — некоторые проекты могут запретить передачу кода третьим сторонам (включая AI-провайдеров)

Правило: если потеря данных может привести к компрометации системы, судебным искам или нарушению договоров — это данные не для ИИ.

**Как настроить защиту:**

Безопасность — это многослойная система. Недостаточно одного `.gitignore`, нужна комбинация мер.

1. **`.gitignore`**. Проверка: `git ls-files | grep -E "secret|key|token|password|\.env"` должна вернуть пустоту.

2. **Правила агента** — многие AI CLI поддерживают исключения. Claude Code: `--exclude "**/.env,**/secrets/**"`. Это не даст агенту случайно прочитать файл, даже если он не в `.gitignore`.

3. **Исключения MCP** — если используете MCP-серверы (Модуль 6), настройте ограничения доступа. Пример для MCP filesystem: разрешить чтение только `~/projects/my-app/src`, запретить `~/.ssh`, `~/.aws`, `~/.config`.

4. **Ограничение доступа серверов** — используйте read-only режимы где возможно. MCP-сервер для работы с базой данных? Подключение с правами только SELECT, без UPDATE/DELETE. MCP-сервер для Git? Только чтение веток, без push.

**Пример из Enji Fleet** (демонстрация безопасного управления credentials):

Credentials управляются через выделенный модуль в системе. Архитектура:

- Session tokens для Claude Code, Codex, OpenCode хранятся в отдельных файлах: `~/.claude/auth.json`, `~/.codex/auth.json`, `~/.local/share/opencode/auth.json`
- При запуске Fleet SDK устанавливает `chmod 0600` на эти файлы — только владелец может читать/писать
- Валидация JSON перед записью токенов предотвращает ошибки формата и инъекции
- Каждый AI CLI получает только свой токен через переменную окружения (`CLAUDE_SESSION_TOKEN`, `CODEX_SESSION_TOKEN`), а не доступ ко всем credentials
- Токены никогда не логируются, не передаются в trace-файлы, не попадают в Git

Это пример принципа изоляции: даже если один агент скомпрометирован, он не получит доступ к credentials других агентов.

**YOLO-мод: удобство vs безопасность**

YOLO-мод (You Only Live Once) — режим работы, когда агент выполняет команды без подтверждения пользователя. `rm -rf node_modules && npm install` выполнится моментально, без вопросов. Удобно для автоматизации, опасно для продакшна.

**Когда допустимо:**
- Тестовые проекты, которые можно пересоздать за минуты
- Изолированные Docker-контейнеры без доступа к host-системе
- Одноразовые скрипты для анализа данных
- CI/CD пайплайны с чёткими ограничениями

**Когда категорически нет:**
- Работа с production базами данных (одна команда DROP TABLE — и всё)
- Критичные системы (deployment на продакшн без ревью)
- Проекты с приватными данными (агент может случайно отправить данные в логи)
- Проекты с денежными операциями (перевод $10K вместо $100)

В **Enji Fleet** YOLO-мод используется, но только внутри Docker-контейнеров с git worktree. Каждый агент работает в изолированном worktree (`git worktree add ../enji-fleet-<plan-name>`), который удаляется после завершения.

**Грамотная настройка: defence in depth**

> [Диаграмма: Defence in Depth — многослойная защита](../diagrams/defence-in-depth.md)

- **Sandboxing** — запускайте агентов в Docker-контейнерах или виртуальных машинах. Даже если агент скомпрометирован, он ограничен контейнером. Fleet SDK агенты работают в Docker-образе `fleet-agent-image` с минимальным набором прав.

- **Read-only режимы** — для задач типа ревью кода, анализа архитектуры, аудита безопасности агенту не нужна запись. Монтируйте репозиторий как readonly volume в Docker.

- **Ограничение сетевого доступа** — MCP-серверы не должны иметь доступ в интернет без явной необходимости. Если MCP-сервер работает с локальной БД, заблокируйте ему исходящие соединения через firewall или Docker network policies.

- **Whitelist подходы** — явно указывайте, что разрешено ("разрешены только команды git, npm, pytest"), вместо того чтобы запрещать конкретные команды ("запрещён rm"). Blacklist всегда неполон, whitelist безопаснее.

- **Логирование и аудит** — все действия агентов должны логироваться. В Fleet используются trace-файлы, которые фиксируют не только результат, но и процесс: какие команды выполнены, какие файлы изменены, какие решения приняты.
---

[← Модуль 8: Ответственное использование ИИ](01-ai-limitations.md) | [Оглавление](../../../README.md) | [3. Ответственность по уровням →](03-responsibility.md)
